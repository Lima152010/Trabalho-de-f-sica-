<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Movimento Parabolico com Imagem</title>
    <link rel="stylesheet" href="../CSSs/stylePa.css">
    <link rel="shortcut icon" href="../img/logo.png" type="image/x-icon">
</head>
<body>
    <div id="corte"></div>
    <div id="container">
        <header>
            <h2>Simulador de Movimento Parabolico</h2>
            <img style="margin-left: 15pxa;" width="50px" src="../img/logo.png" alt="">
        </header>

        <div id="forms">
            <label>Posição Inicial (m): <input type="number" id="posInicial" value="0"></label>
            <label>Posição Final (m): <input type="number" id="posFinal" value="100"></label>
            <label>Velocidade (m/s): <input type="number" id="velocidade" value="10"></label>
            <br>
            <a href="#exe" style="text-decoration: none;"><button onclick="iniciar()">Iniciar</button></a>
            <label>Velocidade Inicial do Míssil (m/s): <input type="number" id="velInicialMissil" value="50"></label>
            <label>Ângulo de Lançamento (graus): <input type="number" id="anguloLancamento" value="45"></label>
            <button onclick="lancarMissil()">Lançar Míssil</button>
        </div>
        <div id="resultados">
            <canvas id="animacao" width="1080" height="460"></canvas>
            <h2 id="re"></h2>
            <div id="tabelaResultados"></div>
            <div id="exe">
                <h1>Movimento Parabolico</h1>
                <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cum consectetur iste culpa, in incidunt quis illum ad assumenda eligendi velit, quia voluptates ab nulla dignissimos quos? Laudantium temporibus corporis esse!
                </p>
            </div>
        </div>
    </div>
    <footer>
        &copy; Todos direitos reservados &reg;
    </footer>

    <script>
        const imagemCarro = new Image();
        let anim;
        let posAtual;
        let canvas = document.getElementById('animacao');
        let ctx = canvas.getContext('2d');
        let largura = canvas.width;
        let altura = canvas.height;
        let escala, direcao;
        let s0, sf, v, fps;
        let missilAtivo = false;
        let missilX = 0;
        let missilY = 0;
        let missilTempo = 0;
        let missilVelInicial = 0;
        let missilAnguloRad = 0;
        imagemCarro.src = '../img/carro_vermelho.png';

        function iniciar() {
        s0 = parseFloat(document.getElementById('posInicial').value);
        sf = parseFloat(document.getElementById('posFinal').value);
        v = parseFloat(document.getElementById('velocidade').value);
        const distancia = Math.abs(sf - s0);
        const tempoTotal = distancia / v;

        frase()
        gerarTabela(s0, v, tempoTotal);

        escala = largura / distancia;

        posAtual = s0;
          direcao = sf >= s0 ? 1 : -1;
            fps = 60;
            const delta = v / fps;

        if (anim) {
            cancelAnimationFrame(anim);
        }
        anim = requestAnimationFrame(animate);
        }

        function frase() {
            let html = "Resultados da tabela"
            document.getElementById('re').innerHTML = html
        }
        function gerarTabela(s0, v, tempoTotal) {
            let html = "<table><tr><th>Tempo (s)</th>";
            // Cabeçalhos dos tempos
            for (let t = 0; t <= tempoTotal; t++) {
                html += `<th>${t}</th>`;
            }
            html += "</tr><tr><th>Posição (m)</th>";
            // Valores das posições
            for (let t = 0; t <= tempoTotal; t++) {
                let s = s0 + v * t;
                html += `<td>${s.toFixed(2)}</td>`;
            }
            html += "</tr></table>";

            document.getElementById('tabelaResultados').innerHTML = html;
        }

        function animate() {


            const delta = v / fps;

            ctx.clearRect(0, 0, largura, altura); // Limpa o canvas

            // Desenhar linha do caminho
            ctx.strokeStyle = "#888";
            ctx.beginPath();
            ctx.moveTo(0, altura / 2);
            ctx.lineTo(largura, altura / 2);
            ctx.stroke();

            const xCarro = (posAtual - s0) * escala;
            const yCarro = altura / 2 - 20;

            ctx.drawImage(imagemCarro, xCarro, yCarro, 50, 40);

            if (missilAtivo) {
                const g = 9.8;
                const escalaVelocidade = 0.2; // Reduz mais a velocidade para melhor visualização
                missilX = 50 + (missilVelInicial * Math.cos(missilAnguloRad) * missilTempo * escalaVelocidade) * escala;
                missilY = altura - 30 - ((missilVelInicial * Math.sin(missilAnguloRad) * missilTempo - 0.5 * g * missilTempo * missilTempo) * escalaVelocidade * escala);

                console.log('Míssil:', {
                    x: missilX,
                    y: missilY,
                    tempo: missilTempo,
                    velocidade: missilVelInicial,
                    angulo: missilAnguloRad * 180 / Math.PI
                });

                if (missilY <= altura && missilX <= largura) {
                    ctx.drawImage(imagemMissil, missilX, missilY - 15, 20, 20);
                }

                // Colisão com o chão ou fora da tela
                if (missilY >= altura || missilX >= largura) {
                    missilAtivo = false;
                    alert('Míssil caiu ou saiu da tela!');
                }

                // Colisão com o carrinho (simplificado)
                const missilCentroX = missilX + 10;
                const missilCentroY = missilY - 7;
                if (missilCentroX >= xCarro && missilCentroX <= xCarro + 50 && missilCentroY >= yCarro && missilCentroY <= yCarro + 40) {
                    missilAtivo = false;
                    cancelAnimationFrame(anim);
                    alert('Míssil atingiu o carrinho!');
                }
                missilTempo += 0.032; // Ajuste da velocidade para melhor visualização
            }

            // Atualiza a posição do carro apenas se não chegou ao destino
            if (!((direcao === 1 && posAtual >= sf) || (direcao === -1 && posAtual <= sf))) {
                posAtual += delta * direcao;
            }

            // Continua a animação se o míssil estiver ativo ou se o carro não chegou ao destino
            if (missilAtivo || !((direcao === 1 && posAtual >= sf) || (direcao === -1 && posAtual <= sf))) {
                anim = requestAnimationFrame(animate);
            } else {
                cancelAnimationFrame(anim);
                anim = null;
            }
        }
        

        const imagemMissil = new Image();
        imagemMissil.onload = () => {
            console.log('Imagem do míssil carregada');
        };
        imagemMissil.onerror = () => {
            console.error('Erro ao carregar imagem do míssil');
            alert('Erro ao carregar imagem do míssil. Por favor, verifique se o arquivo existe.');
        };
        imagemMissil.src = '../img/missil.png';

        function lancarMissil() {
            missilVelInicial = parseFloat(document.getElementById('velInicialMissil').value);
            const anguloLancamento = parseFloat(document.getElementById('anguloLancamento').value);
            missilAnguloRad = anguloLancamento * Math.PI / 180;
            missilTempo = 0;
            missilAtivo = true;
            missilX = 50;
            missilY = altura - 30;

            // Cancela a animação anterior se existir
            if (anim) {
                cancelAnimationFrame(anim);
            }
            // Inicia uma nova animação
            anim = requestAnimationFrame(animate);
        }


    </script>

</body>
</html>

