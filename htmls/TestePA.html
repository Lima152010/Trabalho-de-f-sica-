<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Movimento Parabolico com Imagem</title>
    <link rel="stylesheet" href="../CSSs/stylePa.css">
    <link rel="shortcut icon" href="../img/logo.png" type="image/x-icon">
</head>
<body>
    <div id="corte"></div>
    <div id="container">
        <header>
            <h2>Simulador de Movimento Parabolico</h2>
            <img style="margin-left: 15px;" width="50px" src="../img/logo.png" alt="">
        </header>

        <div id="forms">
            <label>Posição Inicial (m): <input type="number" id="posInicial" value="0"></label>
            <label>Posição Final (m): <input type="number" id="posFinal" value="100"></label>
            <label>Velocidade (m/s): <input type="number" id="velocidade" value="10"></label>
            <br>
            <button onclick="iniciar()">Iniciar</button>
            <label>Velocidade Inicial do Míssil (m/s): <input type="number" id="velInicialMissil" value="50"></label>
            <label>Ângulo de Lançamento (graus): <input type="number" id="anguloLancamento" value="45"></label>
            <button onclick="lancarMissil()">Lançar Míssil</button>
        </div>
        <div id="resultados">
            <canvas id="animacao" width="1080" height="460"></canvas>
            <h2 id="re"></h2>
            <div id="tabelaResultados"></div>
            <div id="exe">
                <h1>Movimento Parabolico</h1>
                <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Cum consectetur iste culpa, in incidunt quis illum ad assumenda eligendi velit, quia voluptates ab nulla dignissimos quos? Laudantium temporibus corporis esse!
                </p>
            </div>
        </div>
    </div>
    <footer>
        &copy; Todos direitos reservados &reg;
    </footer>

    <script>
        const imagemCarro = new Image();
        const imagemMissil = new Image();
        let anim;
        let posAtual;
        let canvas = document.getElementById('animacao');
        let ctx = canvas.getContext('2d');
        let largura = canvas.width;
        let altura = canvas.height;
        let escala, direcao;
        let s0, sf, v, fps;
        let missilAtivo = false;
        let missilX = 0;
        let missilY = 0;
        let missilTempo = 0;
        let missilVelInicial = 0;
        let missilAnguloRad = 0;
        
        // Constantes físicas
        const g = 9.8; // Aceleração da gravidade (m/s²)
        const escalaAltura = 0.5; // Fator de escala para a altura
        
        // Carregar imagens
        imagemCarro.src = '../img/carro_vermelho.png';
        imagemMissil.src = '../img/rocket.webp';
        
        function iniciar() {
            s0 = parseFloat(document.getElementById('posInicial').value);
            sf = parseFloat(document.getElementById('posFinal').value);
            v = parseFloat(document.getElementById('velocidade').value);
            const distancia = Math.abs(sf - s0);
            const tempoTotal = distancia / v;

            frase();
            gerarTabela(s0, v, tempoTotal);

            escala = largura / distancia;
            posAtual = s0;
            direcao = sf >= s0 ? 1 : -1;
            fps = 60;

            if (anim) {
                cancelAnimationFrame(anim);
            }
            anim = requestAnimationFrame(animate);
        }

        function frase() {
            document.getElementById('re').innerHTML = "Resultados da tabela";
        }
        
        function gerarTabela(s0, v, tempoTotal) {
            let html = "<table><tr><th>Tempo (s)</th>";
            for (let t = 0; t <= tempoTotal; t++) {
                html += `<th>${t}</th>`;
            }
            html += "</tr><tr><th>Posição (m)</th>";
            for (let t = 0; t <= tempoTotal; t++) {
                let s = s0 + v * t;
                html += `<td>${s.toFixed(2)}</td>`;
            }
            html += "</tr></table>";
            document.getElementById('tabelaResultados').innerHTML = html;
        }

        function animate() {
            const delta = v / fps;
            ctx.clearRect(0, 0, largura, altura);

            // Desenhar linha do caminho (eixo X) na parte inferior
            ctx.strokeStyle = "#888";
            ctx.beginPath();
            ctx.moveTo(0, altura - 30);
            ctx.lineTo(largura, altura - 30);
            ctx.stroke();

            // Posição do carro (na parte inferior)
            const xCarro = (posAtual - s0) * escala;
            const yCarro = altura - 50; // 50px acima da base
            ctx.drawImage(imagemCarro, xCarro, yCarro, 50, 40);

            if (missilAtivo) {
                missilTempo += 0.016; // Incremento de tempo (~60fps)
                
                // Cálculo da posição do míssil (movimento parabólico)
                missilX = 50 + (missilVelInicial * Math.cos(missilAnguloRad) * missilTempo) * escala;
                
                // Cálculo da posição Y (considerando sistema de coordenadas invertido)
                missilY = (altura - 30) - // Posição de lançamento (30px da base)
                         ((missilVelInicial * Math.sin(missilAnguloRad) * missilTempo - 
                          0.5 * g * missilTempo * missilTempo) * escalaAltura * escala);

                // Desenhar míssil se estiver dentro do canvas
                if (missilY >= 0 && missilX <= largura) {
                    ctx.save();
                    // Rotacionar o míssil de acordo com sua trajetória
                    const velocidadeY = missilVelInicial * Math.sin(missilAnguloRad) - g * missilTempo;
                    const velocidadeX = missilVelInicial * Math.cos(missilAnguloRad);
                    const anguloAtual = Math.atan2(velocidadeY, velocidadeX);
                    
                    ctx.translate(missilX + 10, missilY + 10);
                    ctx.rotate(anguloAtual);
                    ctx.drawImage(imagemMissil, -10, -10, 20, 20);
                    ctx.restore();
                }

                // Verificar colisão com o chão ou saída do canvas
                if (missilY >= altura - 30 || missilX >= largura) {
                    missilAtivo = false;
                    alert('Míssil caiu ou saiu da tela!');
                }

                // Verificar colisão com o carro
                const colisaoX = missilX + 10 >= xCarro && missilX + 10 <= xCarro + 50;
                const colisaoY = missilY + 10 >= yCarro && missilY + 10 <= yCarro + 40;
                
                if (colisaoX && colisaoY) {
                    missilAtivo = false;
                    cancelAnimationFrame(anim);
                    alert('Míssil atingiu o carrinho!');
                }
            }

            // Atualizar posição do carro
            if (!((direcao === 1 && posAtual >= sf) || (direcao === -1 && posAtual <= sf))) {
                posAtual += delta * direcao;
            }

            // Continuar animação se necessário
            if (missilAtivo || !((direcao === 1 && posAtual >= sf) || (direcao === -1 && posAtual <= sf))) {
                anim = requestAnimationFrame(animate);
            } else {
                cancelAnimationFrame(anim);
                anim = null;
            }
        }

        function lancarMissil() {
            missilVelInicial = parseFloat(document.getElementById('velInicialMissil').value);
            const anguloLancamento = parseFloat(document.getElementById('anguloLancamento').value);
            
            // Validar ângulo (deve estar entre 0 e 90 graus)
            if (anguloLancamento <= 0 || anguloLancamento >= 90) {
                alert('Ângulo deve estar entre 0 e 90 graus!');
                return;
            }
            
            missilAnguloRad = anguloLancamento * Math.PI / 180;
            missilTempo = 0;
            missilAtivo = true;
            missilX = 50;
            missilY = altura - 30; // Posição inicial do míssil (na base)

            if (anim) {
                cancelAnimationFrame(anim);
            }
            anim = requestAnimationFrame(animate);
        }
    </script>
</body>
</html>